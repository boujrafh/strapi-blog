#!/bin/bash
# Script de dÃ©ploiement Nginx
# Copiez ce fichier vers deploy-nginx.sh et adaptez les domaines

echo "ğŸš€ DÃ©ploiement des configurations Nginx..."

# Variables Ã  adapter
BLOG_DOMAIN="blog.votre-domaine.com"
CMS_DOMAIN="cms.votre-domaine.com"

# VÃ©rification des fichiers
if [ ! -f "nginx-blog.conf" ]; then
    echo "âŒ Fichier nginx-blog.conf introuvable"
    exit 1
fi

if [ ! -f "nginx-cms.conf" ]; then
    echo "âŒ Fichier nginx-cms.conf introuvable"
    exit 1
fi

# Copie des configurations
echo "ğŸ“‹ Copie des configurations..."
sudo cp nginx-blog.conf "/etc/nginx/sites-available/$BLOG_DOMAIN"
sudo cp nginx-cms.conf "/etc/nginx/sites-available/$CMS_DOMAIN"

# Activation des sites
echo "ğŸ”— Activation des sites..."
sudo ln -sf "/etc/nginx/sites-available/$BLOG_DOMAIN" /etc/nginx/sites-enabled/
sudo ln -sf "/etc/nginx/sites-available/$CMS_DOMAIN" /etc/nginx/sites-enabled/

# Test de la configuration
echo "ğŸ§ª Test de la configuration nginx..."
if sudo nginx -t; then
    echo "âœ… Configuration nginx valide"
    
    # Rechargement
    echo "ğŸ”„ Rechargement de nginx..."
    sudo systemctl reload nginx
    echo "âœ… Nginx rechargÃ© avec succÃ¨s"
    
    echo ""
    echo "ğŸ‰ DÃ©ploiement terminÃ© !"
    echo "ğŸ“ Prochaines Ã©tapes :"
    echo "   1. GÃ©nÃ©rer les certificats SSL :"
    echo "      sudo certbot --nginx -d $BLOG_DOMAIN"
    echo "      sudo certbot --nginx -d $CMS_DOMAIN"
    echo ""
else
    echo "âŒ Erreur dans la configuration nginx"
    exit 1
fi
